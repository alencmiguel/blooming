<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blooming ‚Äî F√≥rum</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Quicksand:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <style>
    .forum-toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
    .forum-toolbar > *{flex:1}
    .vote{display:inline-flex;align-items:center;gap:6px}
    .vote button{cursor:pointer;border:1px solid #ead5e0;background:#fff;border-radius:999px;padding:4px 8px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .edit-area{margin-top:8px}
  </style>
</head>
<body>
<header class="nav">
  <div class="container nav-inner">
    <div class="brand">
      <img class="logo" src="logo.png" alt="Logo Blooming"/>
      <span>Blooming</span>
    </div>
    <nav aria-label="principal">
      <ul>
        <li><a href="index.html#sobre">Sobre</a></li>
        <li><a href="forum.html" aria-current="page">F√≥rum</a></li>
        <li><a href="recursos.html">Recursos</a></li>
        <li><a href="faq.html">FAQ</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="container">
  <section class="panel">
    <div class="hd"><h2>Criar nova publica√ß√£o</h2></div>
    <div class="bd">
      <form id="newForm" class="post-form">
        <div class="forum-toolbar">
          <input class="input" id="nick" placeholder="Seu nome ou apelido (opcional)" />
          <select class="input" id="category" required>
            <option>Menstrua√ß√£o</option>
            <option>Sa√∫de hormonal</option>
            <option>Bem-estar</option>
          </select>
        </div>
        <input class="input" id="title" placeholder="T√≠tulo da sua d√∫vida ou relato" required maxlength="100" />
        <textarea class="input" id="content" placeholder="Escreva com detalhes (o que sente, h√° quanto tempo, o que j√° tentou, etc.)" required></textarea>
        <div class="forum-toolbar">
          <input class="input" id="tags" placeholder="Tags separadas por v√≠rgula (ex.: DIU, c√≥lica, TPM)" />
          <button class="btn btn-primary" type="submit">Publicar</button>
        </div>
        <label style="display:flex;gap:8px;align-items:center">
          <input id="anonToggle" type="checkbox" /> Postar como an√¥nima
        </label>
      </form>
    </div>
  </section>

  <section class="panel">
    <div class="hd">
      <h2>Publica√ß√µes</h2>
      <div class="forum-toolbar">
        <input id="search" class="input" placeholder="Buscar por t√≠tulo, conte√∫do ou tag" />
        <select id="filterCat" class="input">
          <option value="">Todas as categorias</option>
          <option>Menstrua√ß√£o</option>
          <option>Sa√∫de hormonal</option>
          <option>Bem-estar</option>
        </select>
      </div>
    </div>
    <div class="bd">
      <div id="posts" class="posts"></div>
    </div>
  </section>
</main>

<script>
  // ==== helpers & storage ====
  const $ = (q,root=document)=>root.querySelector(q);
  const postsKey = 'blooming_posts';
  const store = {
    get(){ try { return JSON.parse(localStorage.getItem(postsKey)) || []; } catch { return []; } },
    set(v){ localStorage.setItem(postsKey, JSON.stringify(v)); }
  };

  // ==== seed com 2 exemplos (s√≥ se estiver vazio) ====
  if (store.get().length === 0){
    const seed = [
      { id: crypto.randomUUID(), title:"C√≥lica forte no 1¬∫ dia ‚Äî o que ajuda?", category:"Menstrua√ß√£o",
        content:"No primeiro dia sinto c√≥licas intensas e enjoo. O que costuma ajudar voc√™s? Bolsa t√©rmica? Algum cuidado na alimenta√ß√£o?",
        tags:["c√≥lica","1¬∫ dia"], author:"Luna", ts: Date.now()-86400000, votes:12, hidden:false },
      { id: crypto.randomUUID(), title:"DIU de cobre aumentou meu fluxo ‚Äî normal?", category:"Sa√∫de hormonal",
        content:"Coloquei DIU h√° 3 meses e o fluxo ficou maior. Li que pode acontecer no come√ßo. Quanto tempo levou pra estabilizar pra voc√™s?",
        tags:["DIU","fluxo"], author:"An√¥nima", ts: Date.now()-3600000*6, votes:7, hidden:false }
    ];
    store.set(seed);
  }

  // ==== render ====
  function timeAgo(ts){
    const s=Math.max(1,Math.floor((Date.now()-ts)/1000));
    const u=[[31536000,'ano'],[2592000,'m√™s'],[604800,'semana'],[86400,'dia'],[3600,'hora'],[60,'minuto'],[1,'segundo']];
    for(const [sec,name] of u){ if(s>=sec){ const v=Math.floor(s/sec); return `${v} ${name}${v>1&&name!=='m√™s'?'s':''} atr√°s`; } }
    return 'agora';
  }

  function render(){
    const posts = store.get().filter(p=>!p.hidden);
    const q = ($('#search').value||'').toLowerCase().trim();
    const cat = $('#filterCat').value;
    const list = posts.filter(p=>{
      const blob = (p.title+' '+p.content+' '+(p.tags||[]).join(' ')).toLowerCase();
      const cq = !q || blob.includes(q);
      const cc = !cat || p.category===cat;
      return cq && cc;
    }).sort((a,b)=> (b.votes||0)-(a.votes||0) || b.ts-a.ts);

    const box = $('#posts');
    box.innerHTML = '';
    if(list.length===0){ box.innerHTML = `<div class="notice">Nenhuma publica√ß√£o encontrada.</div>`; return; }

    for(const p of list){
      const el = document.createElement('article');
      el.className = 'post';
      const tags = (p.tags||[]).map(t=>`<span class="pill">#${t}</span>`).join(' ');
      el.innerHTML = `
        <div class="meta">${p.category} ‚Ä¢ por <strong>${p.author||'An√¥nima'}</strong> ‚Ä¢ ${timeAgo(p.ts)}</div>
        <div class="title"><a class="post-link" href="post.html?id=${encodeURIComponent(p.id)}">${p.title}</a></div>
        <div class="body" data-view>${p.content}</div>
        <div class="edit-area" hidden>
          <input class="input" data-title value="${p.title.replace(/"/g,'&quot;')}" />
          <textarea class="input" data-content>${p.content}</textarea>
          <input class="input" data-tags value="${(p.tags||[]).join(', ')}" placeholder="Tags (v√≠rgula)"/>
        </div>
        <div class="actions">
  <span class="vote">
    <button data-up>‚ñ≤</button><strong data-count>${p.votes||0}</strong>
  </span>

  <!-- NOVOS bot√µes -->
  <a class="pill pill-btn" href="post.html?id=${encodeURIComponent(p.id)}">Abrir</a>
  <a class="pill pill-btn" href="post.html?id=${encodeURIComponent(p.id)}#responder">üí¨ Responder</a>

  <!-- J√° existiam -->
  <button class="pill pill-btn" data-edit>‚úèÔ∏è Editar</button>
  <button class="pill pill-btn" data-save hidden>üíæ Salvar</button>
  <button class="pill pill-btn" data-cancel hidden>‚Ü© Cancelar</button>
  <button class="pill pill-btn" data-report title="Ocultar do seu feed">üö© Reportar</button>
  <button class="pill pill-btn" data-del>üóëÔ∏è Excluir</button>
</div>

      `;

      // actions
      el.querySelector('[data-up]').addEventListener('click', ()=>{
        const all = store.get(); const me = all.find(x=>x.id===p.id);
        me.votes = (me.votes||0)+1; store.set(all);
        el.querySelector('[data-count]').textContent = me.votes;
      });

      const editBtn   = el.querySelector('[data-edit]');
      const saveBtn   = el.querySelector('[data-save]');
      const cancelBtn = el.querySelector('[data-cancel]');
      const view      = el.querySelector('[data-view]');
      const area      = el.querySelector('.edit-area');
      const ti        = el.querySelector('[data-title]');
      const ta        = el.querySelector('[data-content]');
      const tg        = el.querySelector('[data-tags]');

      editBtn.addEventListener('click', ()=>{
        view.hidden = true; area.hidden = false;
        editBtn.hidden = true; saveBtn.hidden = false; cancelBtn.hidden = false;
      });
      cancelBtn.addEventListener('click', ()=>{
        view.hidden = false; area.hidden = true;
        editBtn.hidden = false; saveBtn.hidden = true; cancelBtn.hidden = true;
      });
      saveBtn.addEventListener('click', ()=>{
        const all = store.get(); const me = all.find(x=>x.id===p.id);
        me.title = ti.value.trim() || me.title;
        me.content = ta.value.trim() || me.content;
        me.tags = tg.value.split(',').map(s=>s.trim()).filter(Boolean);
        store.set(all);
        render();
      });

      el.querySelector('[data-report]').addEventListener('click', ()=>{
        if(confirm('Ocultar esta publica√ß√£o do seu feed?')){
          const all = store.get(); const me = all.find(x=>x.id===p.id);
          me.hidden = true; store.set(all); render();
        }
      });
      el.querySelector('[data-del]').addEventListener('click', ()=>{
        if(confirm('Excluir esta publica√ß√£o?')){
          const all = store.get().filter(x=>x.id!==p.id); store.set(all); render();
        }
      });

      $('#posts').appendChild(el);
    }
  }

  // ==== eventos ====
  $('#newForm').addEventListener('submit',(e)=>{
    e.preventDefault();
    const author = $('#anonToggle').checked ? 'An√¥nima' : ($('#nick').value.trim()||'An√¥nima');
    const title = $('#title').value.trim();
    const content = $('#content').value.trim();
    const category = $('#category').value;
    const tags = $('#tags').value.split(',').map(s=>s.trim()).filter(Boolean);

    const all = store.get();
    all.push({ id: crypto.randomUUID(), title, content, category, tags, author, ts: Date.now(), votes:0, hidden:false });
    store.set(all);
    e.target.reset(); $('#anonToggle').checked=false;
    render();
  });

  $('#search').addEventListener('input', render);
  $('#filterCat').addEventListener('change', render);

  render();
</script>
</body>
</html>
